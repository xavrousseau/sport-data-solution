# ================================================================================
# FICHIER : Dockerfile.airflow
# OBJET   : Image stable et minimale pour Apache Airflow (2.9.0)
#           - Sans surcharge Flask/Session
#           - Avec providers nÃ©cessaires
#           - Timezone configurÃ© en UTC
# AUTEUR  : Xavier Rousseau | Juin 2025
# ================================================================================

# ------------------------------------------------------------------------------
# ðŸ”¹ Base officielle Apache Airflow (Python 3.10)
# ------------------------------------------------------------------------------
FROM apache/airflow:2.9.0-python3.10

# ------------------------------------------------------------------------------
# ðŸ”¹ Ã‰tape 1 : Installation des dÃ©pendances mÃ©tier
# ------------------------------------------------------------------------------
COPY requirements.txt /requirements.txt
RUN pip install --no-cache-dir -r /requirements.txt

# ------------------------------------------------------------------------------
# ðŸ”¹ Ã‰tape 2 : Installation des providers Airflow nÃ©cessaires
# ------------------------------------------------------------------------------
RUN pip install --no-cache-dir \
    apache-airflow-providers-postgres \
    apache-airflow-providers-redis \
    apache-airflow-providers-celery

# ------------------------------------------------------------------------------
# ðŸ”¹ Ã‰tape 3 : Configuration systÃ¨me â€” Fuseau horaire UTC
# ------------------------------------------------------------------------------
USER root
ENV TZ=UTC
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
USER airflow

# ------------------------------------------------------------------------------
# ðŸ”¹ Ã‰tape 4 : RÃ©pertoire de travail par dÃ©faut
# ------------------------------------------------------------------------------
WORKDIR /opt/airflow
