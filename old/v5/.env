# ==========================================================================================
# Fichier    : .env
# Objectif   : Centraliser toutes les variables sensibles/configurables pour la stack Sport Data Solution
# Auteur     : Xavier Rousseau | Juin 2025
# ==========================================================================================

############################################################################################
# 0. Redis — Broker de messages pour Celery (Airflow)
############################################################################################
REDIS_HOST=sport-redis
REDIS_PORT=6379

############################################################################################
# 1. PostgreSQL — Base de données principale
############################################################################################
POSTGRES_USER=user                             # Utilisateur principal de la base
POSTGRES_PASSWORD=password                     # Mot de passe (à personnaliser en production)
POSTGRES_DB=sportdata                          # Nom de la base
POSTGRES_PORT=5432                             # Port exposé localement
POSTGRES_HOST=sport-postgres                   # Nom du conteneur (Docker réseau)

############################################################################################
# 2. MinIO — Stockage Objet S3-compatible
############################################################################################
MINIO_ROOT_USER=minio
MINIO_ROOT_PASSWORD=minio123
MINIO_PORT=9000
MINIO_CONSOLE_PORT=9001
MINIO_HOST=sport-minio

############################################################################################
# 3. Redpanda — Kafka-compatible (streaming temps réel)
############################################################################################
REDPANDA_BROKER_PORT=9092
REDPANDA_ADMIN_PORT=9644
REDPANDA_HOST=sport-redpanda
REDPANDA_CONSOLE_PORT=8085

############################################################################################
# 4. Debezium — Change Data Capture (CDC)
############################################################################################
DEBEZIUM_CONNECT_PORT=8083
DEBEZIUM_BOOTSTRAP_SERVERS=sport-redpanda:9092
DEBEZIUM_GROUP_ID=1
DEBEZIUM_CONFIG_STORAGE_TOPIC=debezium_configs
DEBEZIUM_OFFSET_STORAGE_TOPIC=debezium_offsets
DEBEZIUM_STATUS_STORAGE_TOPIC=debezium_statuses
DEBEZIUM_CONNECT_REST_ADVERTISED_HOST_NAME=connect

############################################################################################
# 5. Spark — Traitement distribué (batch/streaming)
############################################################################################
SPARK_MODE=master
SPARK_UI_PORT=4040
SPARK_CLUSTER_PORT=7077
SPARK_HOST=sport-spark

############################################################################################
# 6. ntfy — Notifications API REST
############################################################################################
NTFY_HTTP_PORT=8080

############################################################################################
# 7. Prometheus & Grafana — Monitoring
############################################################################################
PROMETHEUS_PORT=9090
GRAFANA_PORT=3000

############################################################################################
# 8. Airflow — Orchestration de workflows
############################################################################################
AIRFLOW_EXECUTOR=CeleryExecutor
AIRFLOW__CORE__EXECUTOR=${AIRFLOW_EXECUTOR}

# Configuration du compte admin (UI web)
AIRFLOW_ADMIN_USER=admin
AIRFLOW_ADMIN_PASSWORD=admin
AIRFLOW_ADMIN_EMAIL=admin@example.com
AIRFLOW_ADMIN_FIRSTNAME=Xavier
AIRFLOW_ADMIN_LASTNAME=Rousseau

# Ports exposés
AIRFLOW_WEB_PORT=8092                             # Port UI Web externe
AIRFLOW_FLOWER_PORT=5566                          # Port Flower externe

# Chemins internes
AIRFLOW_HOME=/opt/airflow
DAGS_FOLDER=/opt/airflow/dags

# Sécurité et backend
AIRFLOW__CORE__FERNET_KEY=DcDt5DtguoXRfVACBP9SLhiU9kx_Hk7r53F0kAgOCsc=
AIRFLOW__WEBSERVER__SECRET_KEY=DcDt5DtguoXRfVACBP9SLhiU9kx_Hk7r53F0kAgOCsc=
AIRFLOW__CELERY__BROKER_URL=redis://${REDIS_HOST}:${REDIS_PORT}/0
AIRFLOW__CELERY__RESULT_BACKEND=db+postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}/${POSTGRES_DB}
AIRFLOW__DATABASE__SQL_ALCHEMY_CONN=postgresql+psycopg2://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}/${POSTGRES_DB}

############################################################################################
# 9. DBT — Data Build Tool (transformations SQL)
############################################################################################
DBT_TARGET=dev
PGHOST=${POSTGRES_HOST}
PGPORT=${POSTGRES_PORT}
PGUSER=${POSTGRES_USER}
PGPASSWORD=${POSTGRES_PASSWORD}
PGDATABASE=${POSTGRES_DB}
DBT_PROFILES_DIR=/usr/app

############################################################################################
# 10. Metabase — Business Intelligence
############################################################################################
METABASE_PORT=3001
MB_TIMEZONE=Europe/Paris

############################################################################################
# 11. pgAdmin — Interface graphique PostgreSQL
############################################################################################
PGADMIN_DEFAULT_EMAIL=admin@sportdata.fr
PGADMIN_DEFAULT_PASSWORD=admin
PGADMIN_PORT=5050
PGADMIN_LISTEN_PORT=80

############################################################################################
# 12. Google Maps API — Pour simulation (géocoding, distance)
############################################################################################
GOOGLE_API_KEY=AIzaSyAdIGjXTvfuPS-lHPborXFL-Hc3WjBpPIg

############################################################################################
# 13. Simulation d’activités — Paramètres des scripts init
############################################################################################
SIMULATION_MONTHS=12
SIMULATION_MIN_ACTIVITIES=10
SIMULATION_MAX_ACTIVITIES=100

############################################################################################
# 14. Répertoires de données — Utilisés dans Airflow & Power BI
############################################################################################
INPUT_DATA_PATH=/opt/airflow/data/inputs
OUTPUT_DATA_PATH=/opt/airflow/data/outputs
EXPORT_DATA_PATH=/opt/airflow/data/exports
SCRIPTS_PATH=/opt/airflow/scripts

############################################################################################
# 15. Qualité des données — Validation dans les DAGs/scripts
############################################################################################
ENABLE_QUALITY_CHECKS=True
RAISE_ON_DISTANCE_ERROR=False

############################################################################################
# 16. Export Power BI — Format et table cible
############################################################################################
EXPORT_FORMAT=csv
POWERBI_EXPORT_TABLE=avantages_sportifs_export

# ==========================================================================================
# FIN DU FICHIER — .env
# ==========================================================================================
