# ==========================================================================================
# Fichier    : docker-compose.override.pgadmin.yml (full .env)
# Objectif   : Ajouter pgAdmin (UI web) pour requ√™ter, administrer et monitorer PostgreSQL
# Auteur     : Xavier Rousseau | Juin 2025
#
# Ce fichier ajoute une interface d‚Äôadministration web pour PostgreSQL :
#   - Acc√®s complet √† la base, requ√™tage, sauvegarde/restauration, gestion des droits
#   - Configuration 100% par .env (aucune info statique ou mot de passe en dur)
#   - Persistance locale du profil pgAdmin (favoris, connexions, historiques)
#   - Pr√™t pour d√©mo, formation, dev, prod ou audit
# ==========================================================================================
 
services:

  # ----------------------------------------------------------------------------------------
  # sport-pgadmin ‚Äî Interface web d‚Äôadministration PostgreSQL
  #
  # üéØ  R√¥le :
  #     - Permet d‚Äôadministrer PostgreSQL via une UI web moderne
  #     - G√®re comptes, sch√©mas, sauvegardes, requ√™tes, triggers, droits utilisateurs‚Ä¶
  #
  # üîó  Acc√®s :
  #     - http://localhost:${PGADMIN_PORT} (le port externe est pilot√© par .env)
  #
  # üíæ  Persistance :
  #     - Les pr√©f√©rences, favoris, historiques et profils sont stock√©s dans ./pgadmin c√¥t√© h√¥te
  #
  # üö¶  D√©marrage :
  #     - Attend que PostgreSQL soit op√©rationnel (`depends_on`)
  #     - Peut √™tre red√©marr√© sans perte d‚Äô√©tat utilisateur
  #
  # üõ°Ô∏è  S√©curit√© :
  #     - Aucun login/mdp en dur : tout passe par .env (modifiable √† chaud)
  # ----------------------------------------------------------------------------------------
  sport-pgadmin:
    image: dpage/pgadmin4                         # Image officielle, √† jour
    container_name: sport-pgadmin
    restart: always

    # -----------------------------------------------------------
    # Variables d‚Äôenvironnement pour login initial et port
    # -----------------------------------------------------------
    environment:
      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_DEFAULT_EMAIL}         # Login admin pgAdmin (via .env)
      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_DEFAULT_PASSWORD}   # Mot de passe (via .env)
      PGADMIN_LISTEN_PORT: ${PGADMIN_LISTEN_PORT}             # Port interne UI (par d√©faut 80)

    # -----------------------------------------------------------
    # Port externe pilot√© par .env (par d√©faut : 5050 ou 8081 selon projet)
    # -----------------------------------------------------------
    ports:
      - "${PGADMIN_PORT}:80"

    # -----------------------------------------------------------
    # Volume local pour la persistance (profils utilisateurs, favoris, etc.)
    # Si tu veux un profil "jetable", retire ce volume !
    # -----------------------------------------------------------
    volumes:
      - ./pgadmin:/var/lib/pgadmin

    # -----------------------------------------------------------
    # D√©marre seulement apr√®s PostgreSQL pour √©viter toute erreur de connexion initiale
    # -----------------------------------------------------------
    depends_on:
      - sport-postgres

    # -----------------------------------------------------------
    # Rattachement au m√™me r√©seau que le reste de la stack pour acc√®s direct au service DB
    # -----------------------------------------------------------
    networks:
      - sportdata_net

# ==========================================================================================
# FIN DE FICHIER ‚Äî docker-compose.override.pgadmin.yml
# ==========================================================================================
