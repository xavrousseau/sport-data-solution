# ====================================================================================
# FICHIER   : docker/docker-compose.override.pgadmin.yml
# OBJET     : DÃ©ploiement de pgAdmin (UI web d'administration PostgreSQL)
# CONTEXTE  : Interface simple pour gÃ©rer PostgreSQL manuellement depuis le navigateur
# ====================================================================================

services:

  # ------------------------------------------------------------------------------
  # ğŸ› ï¸ Service pgAdmin â€” Interface dâ€™administration de la base PostgreSQL
  # ------------------------------------------------------------------------------
  sport-pgadmin:
    image: dpage/pgadmin4:latest
    container_name: sport-pgadmin

    ports:
      - "${PGADMIN_PORT}:80"  # UI accessible via http://localhost:5050

    environment:
      # ğŸ‘¤ Compte administrateur pgAdmin
      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_DEFAULT_EMAIL}
      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_DEFAULT_PASSWORD}

      # âš™ï¸ Port dâ€™Ã©coute interne (toujours 80 dans lâ€™image officielle)
      PGADMIN_LISTEN_PORT: ${PGADMIN_LISTEN_PORT}

    volumes:
      # ğŸ’¾ Volume persistant : stocke les connexions, favoris, config utilisateur
      - pgadmin_data:/var/lib/pgadmin

    restart: unless-stopped  # ğŸ” RedÃ©marre automatiquement sauf arrÃªt manuel

    depends_on:
      sport-postgres:
        condition: service_healthy  # âœ… Attend que PostgreSQL soit prÃªt

    healthcheck:
      # â¤ï¸ VÃ©rifie que lâ€™interface web de pgAdmin est disponible
      test: ["CMD", "curl", "-f", "http://localhost:80/misc/ping"]
      interval: 30s
      timeout: 5s
      retries: 3

    networks:
      - sport-network  # ğŸŒ RÃ©seau partagÃ© avec les autres services

# ------------------------------------------------------------------------------
# ğŸŒ RÃ©seau Docker commun Ã  toute la stack
# ------------------------------------------------------------------------------
networks:
  sport-network:
    driver: bridge

# ------------------------------------------------------------------------------
# ğŸ’¾ Volume persistant pour les donnÃ©es utilisateur pgAdmin
# ------------------------------------------------------------------------------
volumes:
  pgadmin_data:
